---
title: "Getting started with curatedPCaData"
output: 
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{getting-started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE
)
library(tidyverse)
library(viridis)
```

This vignette introduces `curatedPCaData` and provides an overview of the  package using data from TCGA as an example. 

***

3 different data types are currently available: 
    + `gex_*.RData` contains gene expression values
    + `cna_*.RData` contains copy number values
    + `clincial_*.RData` contains clinical/phenotype information
    
These elements are created with internal functions within `curatedPCaData` and are then used to derive additional measures, such as immune scores. 
Not all datasets will contain each of these elements but at  minimum will contain `clinical_*.rda` and `gex_*.rda`.

These individual elements are combined into a `MultiAssayExperiment object` (abbreviation: `MAE`, in lower case by convention) called `mae_*.rda`. 


## Introduction 

The `curatedPCaData` package contains a collection of manually curated datasets concerning patients diagnosed with prostate cancer. The datasets within this package have followed uniform processing and naming conventions to allow users to more easily reproduce similar analyses between datasets and spend less time concerned with harmonzing data from different resources. 

In this vignette, we will : 

1. Provide an introduction to `curatedPCaData`. 
2. Show how to run a simple analysis using the data  

## Importing data

The individual elements are housed within the `data-raw/` folder of the package [github repo](https://github.com/Syksy/curatedPCaData) and follows a simple naming convention of `data type` and `first author` separated by a `_` (see dataset types above). 
Each indivdual element for creating the final `MAE` were created using internal functions (accessible with `:::`).
A `MAE` for each study is provided to the users. 

To get a full list of available datasets use the `data` function:
```{r importing}
library(curatedPCaData)
data(package="curatedPCaData")
```

Individual datasets can also be imported by using the `data` function

```{r data-import}
data("mae_tcga")
mae_tcga
```

For more information on working with `mae`s please see the BioConductor `MutliAssayExperiment` package [documentation](https://bioconductor.org/packages/devel/bioc/vignettes/MultiAssayExperiment/inst/doc/QuickStartMultiAssay.html). 

## Example analysis

Daniel will put some text here about doing a simple analysis and perform an analysis here: 
  + survival analysis usinng alternative outcomes (BCR or mets)
  + use multiple datasets
  + example: http://www.bioconductor.org/packages/release/data/experiment/vignettes/curatedOvarianData/inst/doc/curatedOvarianData_vignette.pdf

```{r subset_data,eval=FALSE}
wide_tcga <- MultiAssayExperiment::wideFormat(mae_tcga["PTEN", , ],
    colDataCols=c("overall_survival_status", "days_to_overall_survival", "gleason_grade"))
summary(glm(days_to_overall_survival ~ GEX_PTEN + gleason_grade, data = wide_tcga))
```

## Immune deconvolution

Tumor progression depends on the immune cell composition in the tumor microenvironment. The '[immunedeconv](https://github.com/icbi-lab/immunedeconv)' package consists of different computational methods to computationally estimate immune cell content using gene expression data.

The deconvolution methods we use here are:
  + quantiseq
  + xcell
  + epic
  + mcp_counter

To run any deconvolution method with the default parameters, the following command can be used

```{r immune-dconv,eval=FALSE}
immunedeconv::deconvolute(gene_expression_matrix, method)
```

The rows of the gene expression matrix are HGNC gene symbols and the columns are the sample. Method can be one of them listed above.

For example, the following command can be used to run quantiseq over the TCGA GEX matrix in the package

```{r quantiseq,eval=FALSE}
gex_tcga <- curatedPCaData::mae_tcga[["gex"]]
immunedeconv::deconvolute(gex_tcga,quantiseq)
```

Since the TCGA data in the package is median centered, we also provided a TPM normalized dataset for TCGA prostate cancer samples. This is solely because the deconvolution methods ideally would require a TPM normalized input. We obtained the TPM normalized GEX data from the OSF repository.

For benchmarking, we compare the deconvolution results results between the data from the OSF repository with the TCGA GEX data in our package, by generating correlation plots.
The plots below show the comparison of immune cell propotions in OSF data vs Package TCGA data for every immune cell type generated by all the deconvolution methods.

```{r immunedeconv-plots, echo=FALSE}
tcga_gex <- curatedPCaData::mae_tcga[["gex"]]
tcga_gex <- tcga_gex[rowSums(is.na(tcga_gex)) != ncol(tcga_gex), ]

package_data <- t(tcga_gex)

package <- data.frame(package_data)
data.table::setDT(package, keep.rownames = "V1")
## OSF 
# Replace the "." with "-" in package data sample names
package$V1 <- gsub("\\.","-",package$V1)
# Remove "-01"s from package data
package$V1 <- gsub("*-01","",package$V1)


osf <- osf[rowSums(is.na(osf)) != ncol(osf), ]
osf <- osf[,colSums(is.na(osf))!= nrow(osf)]
## merge package and osf data
merged_package_osf <- merge(osf,package,by.x='AliquotBarcode',by.y="V1")

osf_final <- merged_package_osf %>% dplyr::select(1:58685) 
package_final <- merged_package_osf %>% dplyr::select(1,58686:78643)

osf_final1 <- t(osf_final)
#rownames(osf_final) = osf_final[,1]

osf_final2 <- data.frame(osf_final1)
colnames(osf_final2) = osf_final2[1, ]
osf_final2 <- osf_final2[-1, ]


data.table::setDT(osf_final2, keep.rownames = "V1")
osf_final2$V1 <-gsub("\\.x*","",osf_final2$V1)

  
osf_final3 <- as.matrix(osf_final2)
rownames(osf_final3) = osf_final3[,1]
osf_final3 <- osf_final3[,-1]

mode(osf_final3) <- "numeric"


quantiseq_osf <- immunedeconv::deconvolute(osf_final3,"quantiseq")
epic_osf <- immunedeconv::deconvolute(osf_final3,"epic")
xcell_osf <- immunedeconv::deconvolute(osf_final3,"xcell")
mcp_osf <- immunedeconv::deconvolute(osf_final3,"mcp_counter")

package_final <- t(package_final)
package_final2 <- as.data.frame(package_final)
colnames(package_final2) = package_final2[1, ]
package_final2 <- package_final2[-1, ]
data.table::setDT(package_final2, keep.rownames = "V1")
package_final2$V1 <-gsub("\\.y*","",package_final2$V1)
 
package_final3 <- as.matrix(package_final2)
rownames(package_final3) = package_final3[,1]
package_final3 <- package_final3[,-1]
mode(package_final3) <- "numeric"
quantiseq_package <- immunedeconv::deconvolute(package_final3,"quantiseq")
epic_package <- immunedeconv::deconvolute(package_final3,"epic")
xcell_package <- immunedeconv::deconvolute(package_final3,"xcell")
mcp_package <- immunedeconv::deconvolute(package_final3,"mcp_counter")


xcell_osf_t <- t(xcell_osf)
colnames(xcell_osf_t) = xcell_osf_t[1, ]
xcell_osf_t <- xcell_osf_t[-1, ]
xcell_osf_t <- data.frame(xcell_osf_t)
data.table::setDT(xcell_osf_t, keep.rownames = "V1")
xcell_package_t <- t(xcell_package)
colnames(xcell_package_t) = xcell_package_t[1, ]
xcell_package_t <- xcell_package_t[-1, ]
xcell_package_t <- data.frame(xcell_package_t)
data.table::setDT(xcell_package_t, keep.rownames = "V1")

epic_osf_t <- t(epic_osf)
colnames(epic_osf_t) = epic_osf_t[1, ]
epic_osf_t <- epic_osf_t[-1, ]
epic_osf_t <- data.frame(epic_osf_t)
data.table::setDT(epic_osf_t, keep.rownames = "V1")
epic_package_t <- t(epic_package)
colnames(epic_package_t) = epic_package_t[1, ]
epic_package_t <- epic_package_t[-1, ]
epic_package_t <- data.frame(epic_package_t)
data.table::setDT(epic_package_t, keep.rownames = "V1")

mcp_osf_t <- t(mcp_osf)
colnames(mcp_osf_t) = mcp_osf_t[1, ]
mcp_osf_t <- mcp_osf_t[-1, ]
mcp_osf_t <- data.frame(mcp_osf_t)
data.table::setDT(mcp_osf_t, keep.rownames = "V1")
mcp_package_t <- t(mcp_package)
colnames(mcp_package_t) = mcp_package_t[1, ]
mcp_package_t <- mcp_package_t[-1, ]
mcp_package_t <- data.frame(mcp_package_t)
data.table::setDT(mcp_package_t, keep.rownames = "V1")

quantiseq_osf_t <- t(quantiseq_osf)
colnames(quantiseq_osf_t) = quantiseq_osf_t[1, ]
quantiseq_osf_t <- quantiseq_osf_t[-1, ]
quantiseq_osf_t <- data.frame(quantiseq_osf_t)
data.table::setDT(quantiseq_osf_t, keep.rownames = "V1")
quantiseq_package_t <- t(quantiseq_package)
colnames(quantiseq_package_t) = quantiseq_package_t[1, ]
quantiseq_package_t <- quantiseq_package_t[-1, ]
quantiseq_package_t <- data.frame(quantiseq_package_t)
data.table::setDT(quantiseq_package_t, keep.rownames = "V1")

```

## Quantiseq
```{r,echo=FALSE}
plot(quantiseq_osf_t$B.cell,quantiseq_package_t$B.cell,xlab="osf_Bcells",ylab="package_Bcells")
segments(0,0,1,1,col="grey")
plot(quantiseq_osf_t$Macrophage.M1,quantiseq_package_t$Macrophage.M1,xlab="osf_Macrophage_M1",ylab="package_macrophage_M1")
segments(0,0,1,1,col="grey")
plot(quantiseq_osf_t$Macrophage.M2,quantiseq_package_t$Macrophage.M2,xlab="osf_Macrophage_M2",ylab="package_macrophage_M2")
segments(0,0,1,1,col="grey")
plot(quantiseq_osf_t$Monocyte,quantiseq_package_t$Monocyte,xlab="osf_monocyte",ylab="package_monocyte")
segments(0,0,1,1,col="grey")
plot(quantiseq_osf_t$Neutrophil,quantiseq_package_t$Neutrophil,xlab="osf_neutrophil",ylab="package_neutrophil")
segments(0,0,1,1,col="grey")
plot(quantiseq_osf_t$NK.cell,quantiseq_package_t$NK.cell,xlab="osf_NK_cell",ylab="package_NK_cell")
segments(0,0,1,1,col="grey")
plot(quantiseq_osf_t$T.cell.CD4...non.regulatory.,quantiseq_package_t$T.cell.CD4...non.regulatory.,xlab="osf_CD4",ylab="Package_CD4")
segments(0,0,1,1,col="grey")
plot(quantiseq_osf_t$T.cell.CD8.,quantiseq_package_t$T.cell.CD8.,xlab="osf_CD8",ylab="Package_CD8")
segments(0,0,1,1,col="grey")
plot(quantiseq_osf_t$T.cell.regulatory..Tregs.,quantiseq_package_t$T.cell.regulatory..Tregs.,xlab="osf_Tregs",ylab="package_Tregs")
segments(0,0,1,1,col="grey")
plot(quantiseq_osf_t$Myeloid.dendritic.cell,quantiseq_package_t$Myeloid.dendritic.cell,xlab="osf_Myeloid.dendritic.cell",ylab="package_Myeloid.dendritic.cell")
segments(0,0,1,1,col="grey")
plot(quantiseq_osf_t$uncharacterized.cell,quantiseq_package_t$uncharacterized.cell,xlab="osf_uncharacterized.cell",ylab="package_uncharacterized.cell")
segments(0,0,1,1,col="grey")
```

## XCELL

```{r,echo=FALSE}
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Dendritic_cells_activated.png")
plot(xcell_osf_t$Myeloid.dendritic.cell.activated,xcell_package_t$Myeloid.dendritic.cell.activated,xlab="osf_Dendritic_cells_activated",ylab="package_Dendritic_cells_activated")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/B_cells.#png")
plot(xcell_osf_t$B.cell,xcell_package_t$B.cell,xlab="osf_Bcells",ylab="package_Bcells")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/macrophage_M1.#png")
plot(xcell_osf_t$Macrophage.M1,xcell_package_t$Macrophage.M1,xlab="osf_Macrophage_M1",ylab="package_macrophage_M1")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/macrophage_M2.#png")
plot(xcell_osf_t$Macrophage.M2,xcell_package_t$Macrophage.M2,xlab="osf_macrophage_M2",ylab="package_macrophage_M2")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Tcell_CD4_memory.#png")
plot(xcell_osf_t$T.cell.CD4..memory,xcell_package_t$T.cell.CD4..memory,xlab="osf_Tcell_CD4_memory",ylab="package_Tcell_CD4_memory")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Tcell_CD4_naive.#png")
plot(xcell_osf_t$T.cell.CD4..naive,xcell_package_t$T.cell.CD4..naive,xlab="osf_Tcell_CD4_naive",ylab="package_Tcell_CD4_naive")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Tcell_CD4_nonregulatory.#png")
plot(xcell_osf_t$T.cell.CD4...non.regulatory.,xcell_package_t$T.cell.CD4...non.regulatory.,xlab="osf_Tcell_CD4_nonregulatory",ylab="package_Tcell_CD4_nonregulatory")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Tcell_CD4_central_memory.#png")
plot(xcell_osf_t$T.cell.CD4..central.memory,xcell_package_t$T.cell.CD4..central.memory,xlab="osf_Tcell_CD4_central_memory",ylab="package_Tcell_CD4_central_memory")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Tcell_CD4_effector_memory.#png")
plot(xcell_osf_t$T.cell.CD4..effector.memory,xcell_package_t$T.cell.CD4..effector.memory,xlab="osf_Tcell_CD4_effector_memory",ylab="package_Tcell_CD4_effector_memory")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Tcell_CD8_naive.#png")
plot(xcell_osf_t$T.cell.CD8..naive,xcell_package_t$T.cell.CD8..naive,xlab="osf_Tcell_CD8_naive",ylab="package_Tcell_CD8_naive")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/CD8.#png")
plot(xcell_osf_t$T.cell.CD8.,xcell_package_t$T.cell.CD8.,xlab="osf_CD8",ylab="package_CD8")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/CD8_central_memory.#png")
plot(xcell_osf_t$T.cell.CD8..central.memory,xcell_package_t$T.cell.CD8..central.memory,xlab="osf_CD8_central_memory",ylab="package_CD8_central_memory")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/CD8_effector_memory.#png")
plot(xcell_osf_t$T.cell.CD8..effector.memory,xcell_package_t$T.cell.CD8..effector.memory,xlab="osf_CD8_effector_memory",ylab="package_CD8_effector_memory")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Class_switched_memory_B_cell.#png")
plot(xcell_osf_t$Class.switched.memory.B.cell,xcell_package_t$Class.switched.memory.B.cell,xlab="osf_Class_switched_memory_B_cell",ylab="package_Class_switched_memory_B_cell")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/lymphoid_progenitor.#png")
plot(xcell_osf_t$Common.lymphoid.progenitor,xcell_package_t$Common.lymphoid.progenitor,xlab="osf_lymphoid_progenitor",ylab="package_lymphoid_progenitor")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/myeloid_progenitor.#png")
plot(xcell_osf_t$Common.myeloid.progenitor,xcell_package_t$Common.myeloid.progenitor,xlab="osf_myeloid_progenitor",ylab="package_myeloid_progenitor")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Myeloid_dendritic_cell.#png")
plot(xcell_osf_t$Myeloid.dendritic.cell,xcell_package_t$Myeloid.dendritic.cell,xlab="osf_Myeloid_dendritic_cell",ylab="package_Myeloid_dendritic_cell")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/endothelial_cell.#png")
plot(xcell_osf_t$Endothelial.cell,xcell_package_t$Endothelial.cell,xlab="osf_endothelial_cell",ylab="package_endothelial_cell")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Eosinophil.#png")
plot(xcell_osf_t$Eosinophil,xcell_package_t$Eosinophil,xlab="osf_Eosinophil",ylab="package_Eosinophil")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/CAF.#png")
plot(xcell_osf_t$Cancer.associated.fibroblast,xcell_package_t$Cancer.associated.fibroblast,xlab="osf_CAF",ylab="package_CAF")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Granulocyte_monocyte_progenitor.#png")
plot(xcell_osf_t$Granulocyte.monocyte.progenitor,xcell_package_t$Granulocyte.monocyte.progenitor,xlab="osf_Granulocyte_monocyte_progenitor",ylab="package_Granulocyte_monocyte_progenitor")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Hematopoietic_stem_cell.#png")
plot(xcell_osf_t$Hematopoietic.stem.cell,xcell_package_t$Hematopoietic.stem.cell,xlab="osf_Hematopoietic_stem_cell",ylab="package_Hematopoietic_stem_cell")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Macrophage.#png")
plot(xcell_osf_t$Macrophage,xcell_package_t$Macrophage,xlab="osf_Macrophage",ylab="package_Macrophage")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Monocyte.#png")
plot(xcell_osf_t$Monocyte,xcell_package_t$Monocyte,xlab="osf_Monocyte",ylab="package_monocyte")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Neutrophils.#png")
plot(xcell_osf_t$Neutrophil,xcell_package_t$Neutrophil,xlab="osf_neutrophil",ylab="package_neutrophil")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/NK_cells.#png")
plot(xcell_osf_t$NK.cell,xcell_package_t$NK.cell,xlab="osf_NK_Cell",ylab="package_NK_cell")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Tregs.#png")
plot(xcell_osf_t$T.cell.regulatory..Tregs.,xcell_package_t$T.cell.regulatory..Tregs.,xlab="osf_Tregs",ylab="package_Tregs")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Mast_cells.#png")
plot(xcell_osf_t$Mast.cell,xcell_package_t$Mast.cell,xlab="osf_Mast_cell",ylab="package_Mast_cell")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/B_cell_memory.#png")
plot(xcell_osf_t$B.cell.memory,xcell_package_t$B.cell.memory,xlab="osf_B_cell_memory",ylab="package_B_cell_memory")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/B_cell_naive.#png")
plot(xcell_osf_t$B.cell.naive,xcell_package_t$B.cell.naive,xlab="osf_B_cell_naive",ylab="package_B_cell_naive")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/T_cell_NK.#png")
plot(xcell_osf_t$T.cell.NK,xcell_package_t$T.cell.NK,xlab="osf_T_cell_NK",ylab="package_T_cell_NK")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Plasmacytoid_dendritic_cell.#png")
plot(xcell_osf_t$Plasmacytoid.dendritic.cell,xcell_package_t$Plasmacytoid.dendritic.cell,xlab="osf_Plasmacytoid_dendritic_cell",ylab="package_T_cell_Plasmacytoid_dendritic_cell")
segments(0,0,1,1,col="grey")
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/B_cell_plasma.#png")
plot(xcell_osf_t$B.cell.plasma,xcell_package_t$B.cell.plasma,xlab="osf_B_cell_plasma",ylab="package_B_cell_plasma")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/T_cell_gamma_delta.#png")
plot(xcell_osf_t$T.cell.gamma.delta,xcell_package_t$T.cell.gamma.delta,xlab="osf_T_cell_gamma_delta",ylab="package_T_cell_gamma_delta")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Tcell_CD4_Th1.#png")
plot(xcell_osf_t$T.cell.CD4..Th1,xcell_package_t$T.cell.CD4..Th1,xlab="osf_Tcell_CD4_Th1",ylab="package_Tcell_CD4_Th1")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/Tcell_CD4_Th2.#png")
plot(xcell_osf_t$T.cell.CD4..Th2,xcell_package_t$T.cell.CD4..Th2,xlab="osf_Tcell_CD4_Th2",ylab="package_Tcell_CD4_Th2")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/immune_score.#png")
plot(xcell_osf_t$immune.score,xcell_package_t$immune.score,xlab="osf_immune_score",ylab="package_immune_score")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/stroma_score.#png")
plot(xcell_osf_t$stroma.score,xcell_package_t$stroma.score,xlab="osf_stroma_score",ylab="package_stroma_score")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/xcell_subset_before_deconv/OSF_vs_package/microenvironment_score.#png")
plot(xcell_osf_t$microenvironment.score,xcell_package_t$microenvironment.score,xlab="osf_microenvironment_score",ylab="package_microenvironment_score")
segments(0,0,1,1,col="grey")

```
## EPIC

```{r,echo=FALSE}
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/epic_subset_before_deconv/NK_cells.#png")
plot(epic_osf_t$NK.cell,epic_package_t$NK.cell,xlab="osf_NK_Cell",ylab="package_NK_cell")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/epic_subset_before_deconv/B_cells.#png")
plot(epic_osf_t$B.cell,epic_package_t$B.cell,xlab="osf_Bcells",ylab="package_Bcells")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/epic_subset_before_deconv/macrophage.#png")
plot(epic_osf_t$Macrophage,epic_package_t$Macrophage,xlab="osf_Macrophage",ylab="package_macrophage")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/epic_subset_before_deconv/CAF.#png")
plot(epic_osf_t$Cancer.associated.fibroblast,epic_package_t$Cancer.associated.fibroblast,xlab="osf_CAF",ylab="package_CAF")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/epic_subset_before_deconv/CD4.#png")
plot(epic_osf_t$T.cell.CD4.,epic_package_t$T.cell.CD4.,xlab="osf_CD4",ylab="package_CD4")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/epic_subset_before_deconv/CD8.#png")
plot(epic_osf_t$T.cell.CD8.,epic_package_t$T.cell.CD8.,xlab="osf_CD8",ylab="package_CD8")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/epic_subset_before_deconv/endothelial_cell.#png")
plot(epic_osf_t$Endothelial.cell,epic_package_t$Endothelial.cell,xlab="osf_endothelial_cell",ylab="package_endothelial_cell")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/epic_subset_before_deconv/uncharacterized_cell.#png")
plot(epic_osf_t$uncharacterized.cell,epic_package_t$uncharacterized.cell,xlab="osf_uncharacterized_cell",ylab="package_uncharacterized_cell")
segments(0,0,1,1,col="grey")


```
## MCP COUNTER

```{r,echo=FALSE}
#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/mcp_subset_before_deconv/T_cells.#png")
plot(mcp_osf_t$T.cell,mcp_package_t$T.cell,xlab="osf_T_Cell",ylab="package_T_cell")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/mcp_subset_before_deconv/T_cells_CD8.#png")
plot(mcp_osf_t$T.cell.CD8.,mcp_package_t$T.cell.CD8.,xlab="osf_T_Cell_CD8",ylab="package_T_cell_CD8")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/mcp_subset_before_deconv/cytotoxicity_score.#png")
plot(mcp_osf_t$cytotoxicity.score,mcp_package_t$cytotoxicity.score,xlab="osf_cytotoxicity_score",ylab="package_cytotoxicity_score")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/mcp_subset_before_deconv/NK_cell.#png")
plot(mcp_osf_t$NK.cell,mcp_package_t$NK.cell,xlab="osf_NK_cell",ylab="package_NK_cell")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/mcp_subset_before_deconv/B_cell.#png")
plot(mcp_osf_t$B.cell,mcp_package_t$B.cell,xlab="osf_B_cell",ylab="package_B_cell")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/mcp_subset_before_deconv/Monocyte.#png")
plot(mcp_osf_t$Monocyte,mcp_package_t$Monocyte,xlab="osf_monocyte",ylab="package_monocyte")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/mcp_subset_before_deconv/Macrophage_Monocyte.#png")
plot(mcp_osf_t$Macrophage.Monocyte,mcp_package_t$Macrophage.Monocyte,xlab="osf_Macrophage_monocyte",ylab="package_Macrophage_monocyte")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/mcp_subset_before_deconv/Myeloid_dendritic_cell.#png")
plot(mcp_osf_t$Myeloid.dendritic.cell,mcp_package_t$Myeloid.dendritic.cell,xlab="osf_dendritic_cells",ylab="package_dendritic_cells")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/mcp_subset_before_deconv/Neutrophil.#png")
plot(mcp_osf_t$Neutrophil,mcp_package_t$Neutrophil,xlab="osf_Neutrophil",ylab="package_Neutrophil")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/mcp_subset_before_deconv/Endothelial_cell.#png")
plot(mcp_osf_t$Endothelial.cell,mcp_package_t$Endothelial.cell,xlab="osf_Endothelial_cell",ylab="package_Endothelial_cell")
segments(0,0,1,1,col="grey")

#png("D:/curatedPCAdata/varsha/my_deconvolution_run/correlation_plots/mcp_subset_before_deconv/CAF.#png")
plot(mcp_osf_t$Cancer.associated.fibroblast,mcp_package_t$Cancer.associated.fibroblast,xlab="osf_CAF",ylab="package_CAF")
segments(0,0,1,1,col="grey")


```



## Clinical characteristics 

```{r clinical-heatmap}
x <- data(package="curatedPCaData")
data("mae_tcga")
col_names <- colnames(mae_tcga@colData)
present_tcga <- sapply(mae_tcga@colData, function(x)all(is.na(x)))
present_taylor <- sapply(mae_taylor@colData, function(x)all(is.na(x)))
present_sun <- sapply(mae_sun@colData, function(x)all(is.na(x)))
present_hieronymus <- sapply(mae_hieronymus@colData, function(x)all(is.na(x)))
heat_data <- data.frame(measure = col_names,
                        tcga = present_tcga,
                        taylor = present_taylor,
                        sun = present_sun,
                        hieronymous = present_hieronymus)
heat_data <- heat_data %>% 
  pivot_longer(!measure, names_to = "study", values_to = "present") %>% 
  mutate(present = case_when(
    present == "TRUE" ~ "Not available",
    present == "FALSE" ~ "Available",
    TRUE ~ NA_character_
  ))
ggplot(heat_data, aes(study, measure, fill= present)) + 
  geom_tile() + 
  scale_fill_viridis(discrete = TRUE, name = "Variable availability") + 
  labs(x = "", y = "")
```

## Data for non-R users

All data is stored as individual `.RData` files on the github page, however these files can be imported and converted into `csv`s for use in other programing languages using the following script. 

```{r non-r-script}
data(package="curatedPCaData")
```

## Session Info

```{r session-info}
sessionInfo()
```
